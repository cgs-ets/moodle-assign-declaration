{"version":3,"file":"assignsubmission_declaration.min.js","sources":["../src/assignsubmission_declaration.js"],"sourcesContent":["import NewDeclarationModal from 'assignsubmission_declaration/modal_add_new_declaration';\r\n\r\nconst addDeclarationHandler = async function (e) {\r\n    const modal = await NewDeclarationModal.create({})\r\n    console.log(modal)\r\n    modal.show();\r\n\r\n}\r\n\r\nconst selectSubmissionHandler = function (e) {\r\n    if (e.target.checked) {\r\n        // Show elements related to declaration submission\r\n        showSubmissionDeclarationElements();\r\n    } else {\r\n        // Hide elements related to declaration submission\r\n        hideSubmissionDeclarationElements();\r\n\r\n    }\r\n}\r\n\r\nconst hideSubmissionDeclarationElements = function () {\r\n    let match = Array.from(document.querySelectorAll('[id^=id_assignsubmission_declaration_]'));\r\n    document.getElementById('add-new-declaration-btn').style.display = 'none';\r\n    match.forEach(el => {\r\n        if (el.getAttribute('id') != 'id_assignsubmission_declaration_enabled') {\r\n            el.style.display = 'none';\r\n        }\r\n    });\r\n}\r\n\r\nconst showSubmissionDeclarationElements = function () {\r\n    document.getElementById('add-new-declaration-btn').style.display = 'inline-block';\r\n    let match = Array.from(document.querySelectorAll('[id^=id_assignsubmission_declaration_]'));\r\n    match.forEach(el => {\r\n        if (el.getAttribute('id') != 'id_assignsubmission_declaration_enabled') {\r\n            el.style.display = '';\r\n        }\r\n    });\r\n}\r\n\r\nconst changeTextareaHandler = (e) => {\r\n    // Empty textarea\r\n    if (document.getElementById(e.target.id).value == '') {\r\n        document.getElementById(e.target.id).classList.add('empty-value-error');\r\n        document.getElementById(e.target.id).value = \"Declaration description cannot be empty\";\r\n    } else {\r\n        document.getElementById(e.target.id).classList.remove('empty-value-error');\r\n    }\r\n    let id = (e.target.id).split('_');\r\n    id = id[id.length - 1];\r\n    const data = JSON.parse(document.getElementById('id_declarationjson').value);\r\n    const updateData = {\r\n        id: id,\r\n        declaration_text: document.getElementById(e.target.id).value\r\n    };\r\n\r\n    data.forEach((d) => {\r\n        if (d.id == updateData.id && updateData.declaration_text != \"Declaration description cannot be empty\") {\r\n            d.declaration_text = updateData.declaration_text;\r\n        }\r\n    }, updateData);\r\n\r\n    document.getElementById('id_declarationjson').value = JSON.stringify(data);\r\n\r\n}\r\n\r\nconst makeTitleEditable = () => {\r\n\r\n    Array.from(document.querySelectorAll('#fgroup_id_assignsubmission_declaration_group')).forEach((child, index) => {\r\n        let count = index + 1;\r\n        child.setAttribute('id', `fgroup_id_assignsubmission_declaration_group_${count}`);\r\n        Array.from(child.children).forEach((child1, index) => {\r\n            Array.from(child1.children).forEach((child, index) => {\r\n                if (index == 0 && child.nodeName == 'P') {\r\n                    child.setAttribute('contenteditable', true);\r\n                    child.addEventListener('input', changeTitleHandler);\r\n                };\r\n            }, child1);\r\n        });\r\n\r\n    });\r\n\r\n}\r\n\r\nconst changeTitleHandler = (e) => {\r\n    //title div -> textarea div\r\n\r\n    if (document.getElementById(e.target.id).innerHTML == '') {\r\n        document.getElementById(e.target.id).innerHTML = \"Title cannot be empty\";\r\n        document.getElementById(e.target.id).style.border = \"2px solid red\";\r\n    } else {\r\n        document.getElementById(e.target.id).style.border = \"\";\r\n    }\r\n\r\n    let id = e.target.id.split('_'); // Get the element that has the textarea nested and that it has the id we need.\r\n    id = id[id.length - 1];\r\n    const data = JSON.parse(document.getElementById('id_declarationjson').value);\r\n    const updateData = {\r\n        id: id,\r\n        declaration_title: (document.getElementById(e.target.id).innerHTML.replace(/^\\s+|\\s+$/g, ''))\r\n    };\r\n\r\n    data.forEach((d) => {\r\n        if (d.id == updateData.id && updateData.declaration_title != 'Title cannot be empty') {\r\n            d.declaration_title = updateData.declaration_title;\r\n        }\r\n    }, updateData);\r\n\r\n    document.getElementById('id_declarationjson').value = JSON.stringify(data);\r\n}\r\n\r\nconst debounce = (callback, wait) => {\r\n    let timeout;\r\n    return (...args) => {\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(function () {\r\n            callback.apply(this, args);\r\n        }, wait);\r\n    };\r\n}\r\n\r\nconst selectHandler = (e) => {\r\n    let id = e.target.id.split('_');\r\n    id = id[id.length - 2];\r\n    let data = JSON.parse(document.getElementById('id_declarationjson').value);\r\n    let updateData = {\r\n        id: id,\r\n        selected: e.target.checked ? 1 : 0\r\n    }\r\n    data.forEach((d) => {\r\n\r\n        if (d.id == updateData.id) {\r\n            d.selected = updateData.selected;\r\n        }\r\n    }, updateData);\r\n\r\n    document.getElementById('id_declarationjson').value = JSON.stringify(data);\r\n}\r\n\r\nconst deleteDeclarationHandler = (e) => {\r\n\r\n    let id = (e.target.id).split('_');\r\n    id = id[id.length - 1];\r\n    let data = JSON.parse(document.getElementById('id_declarationjson').value);\r\n    let updateData = {\r\n        id: id,\r\n        deleted: 1,\r\n        indextodelete: -1\r\n    }\r\n    if (data.length > 1) {\r\n        data.forEach((d, index) => {\r\n            if (d.id == updateData.id) {\r\n                if (d.sqlid != null) {\r\n                    d.deleted = updateData.deleted;\r\n                } else {\r\n                    updateData.indextodelete = index;\r\n                }\r\n            }\r\n        }, updateData);\r\n        if (updateData.indextodelete > -1) {\r\n            data.splice(updateData.indextodelete, 1);\r\n        }\r\n\r\n        document.getElementById('id_declarationjson').value = JSON.stringify(data);\r\n        // remove element from view.\r\n        document.getElementById(`fgroup_id_assignsubmission_declaration_group_${updateData.id}`).remove();\r\n    } else {\r\n        console.log(\"Just one, cant delete\");\r\n    }\r\n}\r\n\r\nconst refreshDeleteSectionTitle = () => {\r\n    // This function will wait until the user finishes typing the newn title. after, it will refresh the delete title section.\r\n    window.addEventListener('keyup', debounce(() => {\r\n        // code you would like to run 1000ms after the keyup event has stopped firing\r\n        // further keyup events reset the timer, as expected\r\n        let data = JSON.parse(document.getElementById('id_declarationjson').value);\r\n        Array.from(document.querySelectorAll('p[id^=fgroup_id_assignsubmission_declaration_group_label_]')).forEach((p, index) => {\r\n            let id = p.getAttribute('id').split('_');\r\n            id = id[id.length - 1];\r\n            data.forEach((d) => {\r\n                if (d.id == id) {\r\n                    const deletesectiontitle = document.getElementById(`delete_declaration_container_${id}`).innerHTML;\r\n                    const currentTitle = document.getElementById(`delete_declaration_container_${id}`).innerHTML.split('</i>')[1];\r\n                    document.getElementById(`delete_declaration_container_${id}`).innerHTML = deletesectiontitle.replace(currentTitle, `Delete ${d.declaration_title} declaration`);\r\n                    document.getElementById(`fgroup_id_assignsubmission_declaration_group_label_${id}`).setAttribute('data-current-title', d.declaration_title);\r\n                }\r\n            }, id);\r\n\r\n        }, data)\r\n\r\n    }, 1000))\r\n}\r\n\r\nexport const init = () => {\r\n    if (!document.getElementById('id_assignsubmission_declaration_enabled').checked) {\r\n        document.getElementById('add-new-declaration-btn').style.display = 'none';\r\n    } else {\r\n        document.getElementById('add-new-declaration-btn').style.display = 'inline-block';\r\n    }\r\n\r\n    document.getElementById('id_assignsubmission_declaration_enabled').addEventListener('change', selectSubmissionHandler);\r\n    document.querySelector('.add-new-declaration').addEventListener('click', addDeclarationHandler);\r\n\r\n    //Only allow changes when there are no submitted work.\r\n    if (document.getElementById('id_submittedwork').value == 0) {\r\n        // Textarea add event.\r\n        document.querySelectorAll('textarea[id^=id_assignsubmission_declaration_]').forEach((textarea) => {\r\n            textarea.addEventListener('change', changeTextareaHandler);\r\n        });\r\n        // Checkbox add event.\r\n        document.querySelectorAll('input[id^=id_assignsubmission_declaration_]').forEach((checkbox) => {\r\n\r\n            let id = checkbox.getAttribute('id').split('_');\r\n            if (id[id.length - 1] == 'check') {\r\n                checkbox.addEventListener('change', selectHandler);\r\n            }\r\n\r\n        });\r\n\r\n        // Delete event listeners\r\n        document.querySelectorAll('i[id^=delete_declaration_]').forEach((deleteicon) => {\r\n            deleteicon.addEventListener('click', deleteDeclarationHandler);\r\n        });\r\n\r\n\r\n        makeTitleEditable();\r\n        refreshDeleteSectionTitle();\r\n\r\n    } else {\r\n        // Disable textarea,\r\n        document.querySelectorAll('textarea[id^=id_assignsubmission_declaration_]').forEach((textarea) => {\r\n            textarea.setAttribute('disabled', true);\r\n        });\r\n        // Disable checkbox\r\n        document.querySelectorAll('input[id^=id_assignsubmission_declaration_]').forEach((checkbox) => {\r\n\r\n            let id = checkbox.getAttribute('id').split('_');\r\n            if (id[id.length - 1] == 'check') {\r\n                checkbox.setAttribute('disabled', true);\r\n            }\r\n        });\r\n\r\n        document.querySelector('.add-new-declaration-container').style.display = 'none';\r\n        Array.from(document.querySelectorAll('[data-delete-icon]')).forEach(delEl => {\r\n            delEl.style.display = 'none';\r\n        });\r\n        // Show message\r\n        document.querySelector('.it-has-submissions').removeAttribute('hidden');\r\n    }\r\n\r\n\r\n};"],"names":["addDeclarationHandler","async","e","modal","NewDeclarationModal","create","console","log","show","selectSubmissionHandler","target","checked","showSubmissionDeclarationElements","hideSubmissionDeclarationElements","match","Array","from","document","querySelectorAll","getElementById","style","display","forEach","el","getAttribute","changeTextareaHandler","id","value","classList","add","remove","split","length","data","JSON","parse","updateData","declaration_text","d","stringify","changeTitleHandler","innerHTML","border","declaration_title","replace","debounce","callback","wait","timeout","args","clearTimeout","setTimeout","apply","this","selectHandler","selected","deleteDeclarationHandler","deleted","indextodelete","index","sqlid","splice","addEventListener","querySelector","textarea","checkbox","deleteicon","child","count","setAttribute","children","child1","nodeName","window","p","deletesectiontitle","currentTitle","delEl","removeAttribute"],"mappings":"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"}