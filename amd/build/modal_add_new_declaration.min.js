define("assignsubmission_declaration/modal_add_new_declaration",["exports","core/modal","core/custom_interaction_events"],(function(_exports,_modal,_custom_interaction_events){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal=_interopRequireDefault(_modal),_custom_interaction_events=_interopRequireDefault(_custom_interaction_events);const SELECTORS_ADD_BUTTON='[data-action="add"]',SELECTORS_CANCEL_BUTTON='[data-action="cancel"]';class NewDeclarationModal extends _modal.default{static TYPE="assignsubmission_declaration-addnewdeclaration";static TEMPLATE="assignsubmission_declaration/assignsubmission_declaration_modal";registerEventListeners(){super.registerEventListeners(this),this.getModal().on(_custom_interaction_events.default.events.activate,SELECTORS_ADD_BUTTON,function(e,data){const currentIds=Array.from(document.querySelectorAll("[id^=id_assignsubmission_declaration_]")).filter((id=>{if(id.getAttribute("id").match(/(\d+)\D*$/))return id}));let lastNumber=currentIds[currentIds.length-2].getAttribute("id");lastNumber=lastNumber.split("_"),lastNumber=lastNumber.filter((val=>{if(!isNaN(val))return val}));const newID=JSON.parse(document.getElementById("id_declarationjson").value).length+1,newDec={declaration_title:document.getElementById("inputTitle").value,declaration_text:document.getElementById("inputContent").value,id:newID,assignment:document.getElementById("id_declarationjson").getAttribute("assignmentid"),selected:0};if(document.getElementById("inputTitle").classList.remove("input-error"),document.getElementById("inputContent").classList.remove("input-error"),""==newDec.declaration_title)return void document.getElementById("inputTitle").classList.add("input-error");if(""==newDec.declaration_text)return void document.getElementById("inputContent").classList.add("input-error");const declaration=document.getElementById("fgroup_id_assignsubmission_declaration_group_1"),declarationSubmissionContainer=document.getElementById("id_submissiontypescontainer"),btnContainer=document.querySelector(".add-new-declaration-container");let newDeclaration=declaration.cloneNode(!0);newDeclaration.setAttribute("id",`fgroup_id_assignsubmission_declaration_group_${newDec.id}`),Array.from(newDeclaration.children).forEach(((child,index)=>{if(0==index){const newid=`fgroup_id_assignsubmission_declaration_group_label_${JSON.parse(document.getElementById("id_declarationjson").value).length+1}`;child.children[index].setAttribute("id",newid),newDec.old_title=child.children[index].innerHTML.replace(/^\s+|\s+$/g,""),child.children[index].setAttribute("data-current-title",newDec.declaration_title),child.children[index].innerHTML=newDec.declaration_title,child.setAttribute("contenteditable",!0),child.addEventListener("input",(function(e){let id=document.getElementById(e.target.id).nextElementSibling.children[0].children[1].children[1].getAttribute("id");id=id[id.length-1];const data=JSON.parse(document.getElementById("id_declarationjson").value),updateData={id:id,declaration_title:document.getElementById(e.target.id).children[0].innerHTML.replace(/^\s+|\s+$/g,"")};data.forEach((d=>{d.id==updateData.id&&(d.declaration_title=updateData.declaration_title)}),updateData),document.getElementById("id_declarationjson").value=JSON.stringify(data)}))}else Array.from(child.children).forEach(((child,index)=>{0==index&&Array.from(child.children).forEach(((child,index)=>{0==index?child.innerHTML=newDec.declaration_title:Array.from(child.children).forEach(((child,index)=>{if(0==index)child.setAttribute("for",`id_assignsubmission_declaration_${newDec.id}`);else if(1==index)child.innerHTML=newDec.declaration_text,child.removeAttribute("placeholder"),child.setAttribute("value",newDec.declaration_text),child.setAttribute("id",`id_assignsubmission_declaration_${newDec.id}`),child.setAttribute("name",`assignsubmission_declaration_${newDec.id}`);else if(2==index)Array.from(child.children).forEach(((child,index)=>{child.value=0,child.removeAttribute("checked"),child.setAttribute("id",`id_assignsubmission_declaration_${newDec.id}_check`),child.setAttribute("name",`assignsubmission_declaration_${newDec.id}_check`),child.addEventListener("change",(function(e){if(e.target.checked){let declaration=JSON.parse(document.getElementById("id_declarationjson").value);declaration.forEach((decl=>{decl.id==newDec.id&&(decl.selected=1)}),newDeclaration),document.getElementById("id_declarationjson").value=JSON.stringify(declaration)}}))}));else if(3==index){child.setAttribute("data-delete-icon",1),child.removeAttribute("hidden"),Array.from(child.children).forEach(((child,index)=>{child.setAttribute("id",`delete_declaration_container_${newDec.id}`),Array.from(child.children).forEach(((child,index)=>{child.setAttribute("id",`delete_declaration_${newDec.id}`)}))})),child.addEventListener("click",(function(e){let id=e.target.id.split("_");id=id[id.length-1];let data=JSON.parse(document.getElementById("id_declarationjson").value);data=data.filter((d=>{if(d.id!=id)return d}),id),document.getElementById("id_declarationjson").value=JSON.stringify(data),document.getElementById(`fgroup_id_assignsubmission_declaration_group_${id}`).remove()}));const spanText=child.innerHTML;child.innerHTML=spanText.replace(newDec.old_title,newDec.declaration_title)}else child.setAttribute("id",`id_assignsubmission_declaration_${newDec.id}_check`)}))}))}));this.destroy()}),newDec);let decl=JSON.parse(document.getElementById("id_declarationjson").value);decl.push(newDec),document.getElementById("id_declarationjson").value=JSON.stringify(decl),declarationSubmissionContainer.insertBefore(newDeclaration,btnContainer)}.bind(this)),this.getModal().on(_custom_interaction_events.default.events.activate,SELECTORS_CANCEL_BUTTON,function(e,data){this.destroy()}.bind(this))}}return _exports.default=NewDeclarationModal,NewDeclarationModal.registerModalType(),_exports.default}));

//# sourceMappingURL=modal_add_new_declaration.min.js.map