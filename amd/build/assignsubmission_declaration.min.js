define("assignsubmission_declaration/assignsubmission_declaration",["exports","assignsubmission_declaration/modal_add_new_declaration"],(function(_exports,_modal_add_new_declaration){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_add_new_declaration=(obj=_modal_add_new_declaration)&&obj.__esModule?obj:{default:obj};const addDeclarationHandler=async function(e){const modal=await _modal_add_new_declaration.default.create({});console.log(modal),modal.show()},selectSubmissionHandler=function(e){e.target.checked?showSubmissionDeclarationElements():hideSubmissionDeclarationElements()},hideSubmissionDeclarationElements=function(){let match=Array.from(document.querySelectorAll("[id^=id_assignsubmission_declaration_]"));document.getElementById("add-new-declaration-btn").style.display="none",match.forEach((el=>{"id_assignsubmission_declaration_enabled"!=el.getAttribute("id")&&(el.style.display="none")}))},showSubmissionDeclarationElements=function(){document.getElementById("add-new-declaration-btn").style.display="inline-block",Array.from(document.querySelectorAll("[id^=id_assignsubmission_declaration_]")).forEach((el=>{"id_assignsubmission_declaration_enabled"!=el.getAttribute("id")&&(el.style.display="")}))},changeTextareaHandler=e=>{""==document.getElementById(e.target.id).value?(document.getElementById(e.target.id).classList.add("empty-value-error"),document.getElementById(e.target.id).value="Declaration description cannot be empty"):document.getElementById(e.target.id).classList.remove("empty-value-error");let id=e.target.id.split("_");id=id[id.length-1];const data=JSON.parse(document.getElementById("id_declarationjson").value),updateData={id:id,declaration_text:document.getElementById(e.target.id).value};data.forEach((d=>{d.id==updateData.id&&"Declaration description cannot be empty"!=updateData.declaration_text&&(d.declaration_text=updateData.declaration_text)}),updateData),document.getElementById("id_declarationjson").value=JSON.stringify(data)},changeTitleHandler=e=>{""==document.getElementById(e.target.id).innerHTML?(document.getElementById(e.target.id).innerHTML="Title cannot be empty",document.getElementById(e.target.id).style.border="2px solid red"):document.getElementById(e.target.id).style.border="";let id=e.target.id.split("_");id=id[id.length-1];const data=JSON.parse(document.getElementById("id_declarationjson").value),updateData={id:id,declaration_title:document.getElementById(e.target.id).innerHTML.replace(/^\s+|\s+$/g,"")};data.forEach((d=>{d.id==updateData.id&&"Title cannot be empty"!=updateData.declaration_title&&(d.declaration_title=updateData.declaration_title)}),updateData),document.getElementById("id_declarationjson").value=JSON.stringify(data)},debounce=(callback,wait)=>{let timeout;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];clearTimeout(timeout),timeout=setTimeout((function(){callback.apply(this,args)}),wait)}},selectHandler=e=>{let id=e.target.id.split("_");id=id[id.length-2];let data=JSON.parse(document.getElementById("id_declarationjson").value),updateData={id:id,selected:e.target.checked?1:0};data.forEach((d=>{d.id==updateData.id&&(d.selected=updateData.selected)}),updateData),document.getElementById("id_declarationjson").value=JSON.stringify(data)},deleteDeclarationHandler=e=>{let id=e.target.id.split("_");id=id[id.length-1];let data=JSON.parse(document.getElementById("id_declarationjson").value),updateData={id:id,deleted:1,indextodelete:-1};data.length>1?(data.forEach(((d,index)=>{d.id==updateData.id&&(null!=d.sqlid?d.deleted=updateData.deleted:updateData.indextodelete=index)}),updateData),updateData.indextodelete>-1&&data.splice(updateData.indextodelete,1),document.getElementById("id_declarationjson").value=JSON.stringify(data),document.getElementById(`fgroup_id_assignsubmission_declaration_group_${updateData.id}`).remove()):console.log("Just one, cant delete")};_exports.init=()=>{document.getElementById("id_assignsubmission_declaration_enabled").checked?document.getElementById("add-new-declaration-btn").style.display="inline-block":document.getElementById("add-new-declaration-btn").style.display="none",document.getElementById("id_assignsubmission_declaration_enabled").addEventListener("change",selectSubmissionHandler),document.querySelector(".add-new-declaration").addEventListener("click",addDeclarationHandler),0==document.getElementById("id_submittedwork").value?(document.querySelectorAll("textarea[id^=id_assignsubmission_declaration_]").forEach((textarea=>{textarea.addEventListener("change",changeTextareaHandler)})),document.querySelectorAll("input[id^=id_assignsubmission_declaration_]").forEach((checkbox=>{let id=checkbox.getAttribute("id").split("_");"check"==id[id.length-1]&&checkbox.addEventListener("change",selectHandler)})),document.querySelectorAll("i[id^=delete_declaration_]").forEach((deleteicon=>{deleteicon.addEventListener("click",deleteDeclarationHandler)})),Array.from(document.querySelectorAll("#fgroup_id_assignsubmission_declaration_group")).forEach(((child,index)=>{let count=index+1;child.setAttribute("id",`fgroup_id_assignsubmission_declaration_group_${count}`),Array.from(child.children).forEach(((child1,index)=>{Array.from(child1.children).forEach(((child,index)=>{0==index&&"P"==child.nodeName&&(child.setAttribute("contenteditable",!0),child.addEventListener("input",changeTitleHandler))}),child1)}))})),window.addEventListener("keyup",debounce((()=>{let data=JSON.parse(document.getElementById("id_declarationjson").value);Array.from(document.querySelectorAll("p[id^=fgroup_id_assignsubmission_declaration_group_label_]")).forEach(((p,index)=>{let id=p.getAttribute("id").split("_");id=id[id.length-1],data.forEach((d=>{if(d.id==id){const deletesectiontitle=document.getElementById(`delete_declaration_container_${id}`).innerHTML,currentTitle=document.getElementById(`delete_declaration_container_${id}`).innerHTML.split("</i>")[1];document.getElementById(`delete_declaration_container_${id}`).innerHTML=deletesectiontitle.replace(currentTitle,`Delete ${d.declaration_title} declaration`),document.getElementById(`fgroup_id_assignsubmission_declaration_group_label_${id}`).setAttribute("data-current-title",d.declaration_title)}}),id)}),data)}),1e3))):(document.querySelectorAll("textarea[id^=id_assignsubmission_declaration_]").forEach((textarea=>{textarea.setAttribute("disabled",!0)})),document.querySelectorAll("input[id^=id_assignsubmission_declaration_]").forEach((checkbox=>{let id=checkbox.getAttribute("id").split("_");"check"==id[id.length-1]&&checkbox.setAttribute("disabled",!0)})),document.querySelector(".add-new-declaration-container").style.display="none",Array.from(document.querySelectorAll("[data-delete-icon]")).forEach((delEl=>{delEl.style.display="none"})),document.querySelector(".it-has-submissions").removeAttribute("hidden"))}}));

//# sourceMappingURL=assignsubmission_declaration.min.js.map